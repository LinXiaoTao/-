[参考](https://developer.android.com/training/custom-views/optimizing-view.html)

# 优化视图

为了避免运行中出现卡顿，请确保绘制始终以每秒 60 帧的速度运行。



## 减少频繁绘制

为了加速你的 view，对于频繁调用的方法，需要尽量减少不必要的代码。先从 `onDraw()` 开始，需要特别注意不应该在这里做内存分配的事情，因为它会导致 GC，从而导致卡顿。在初始化或者动画间隙期间做分配内存的动作。不要在动画正在执行的时候做内存分配的事情。

你还需要尽可能的减少 `onDraw()` 被调用的次数，大多数时候导致 `onDraw()` 都是因为调用了 `invalidate()`，因此请尽量减少调用 `invalidate()` 的次数。

另一个非常昂贵的操作是遍历布局。任何时候，一个视图调用  `requestLayout()`，Android UI 系统需要遍历整个视图层次结构，以了解每个视图需要多大。如果发现冲突的测量，则可能需要多次遍历层次结构。这些深层次的层次结构导致性能问题。使您的视图层次结构尽可能浅。

如果您有一个复杂的 UI，请考虑编写一个自定义  `ViewGroup` 来执行其布局。与内置视图不同，您的自定义视图可以针对其子项的大小和形状进行特定于应用程序的假设，从而避免遍历其子项以计算度量。