[深入理解HTTPS协议](https://juejin.im/post/5a2fbe1b51882507ae25f991)



### 对称加密和非对称加密

* 对称加密：加密和解密都用一个密钥，优点是速度快，缺点是密钥一旦被截获，就有出现泄漏的危险。
* 非对称加密：有一对密钥，私钥和公钥。用其中一个加密，解密则必须使用另外一个。公钥可以提供给客户端进行加密，服务端保存私钥进行解密。非对称加密非常消耗资源。



### 确保安全通信的三个原则：

* 数据内容的加密
* 通讯双方的身份校验
* 数据内容的完整性



### 中间人攻击

中间人可以将服务器发送的公钥进行调包，导致客户端使用假公钥进行加密，有泄漏的危险。

借助数字证书认证机构（CA）颁发的证书来解决中间人攻击问题。

* 使用 CA 向安全服务器颁发证书
* 服务器通过这个证书将公钥加密后发送给客户端
* 客户端使用 CA 的公钥解密后，获取服务端的公钥



### HTTPS 请求流程

* https(TLS) 是基于 tcp 协议，所以也需要 tcp 的三次握手
* 客户端首先发起 Client Hello，包含随机生成的 random1，支持的加密算法，SSL 信息
* 服务端接收到 Client Hello，取出客户端发来的 random1，然后根据客户端支持的加密算法，生成随机数 random2，通过 Server Hello 发送给客户端
* 服务端将公钥通过数字证书发送给客户端
* 客户端通过 CA 验证证书的合法性，验证成功后取出证书中的服务端公钥，并生成一个随机数 random3，再将 random3 使用服务端公钥生成 PreMaster Key，并发送给服务端
* 服务端使用私钥将 PreMaster Key 解密后获取 random3，此时双房都持有三个随机数，通过这三个随机数生成一个对称加密的密钥
* Change Cipher Spec：告诉客户端以后的通讯都使用这套密钥



### Session Ticket

服务端最后一步的时候传给客户端的数据，在下一次的 HTTPS 请求时，可以带上，省去很多握手时间和资源消耗。



